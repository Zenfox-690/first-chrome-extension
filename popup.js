function send(e){chrome.tabs.query({active:!0,currentWindow:!0},([t])=>{t?.id&&chrome.tabs.sendMessage(t.id,e)})}function debounce(e,t){let a;return(...s)=>{clearTimeout(a),a=setTimeout(()=>e.apply(this,s),t)}}function showToast(e){let t=document.getElementById("toastContainer"),a=document.createElement("div");a.className="toast",a.textContent=e,t.appendChild(a),setTimeout(()=>t.removeChild(a),3e3)}document.addEventListener("DOMContentLoaded",()=>{let e=e=>document.getElementById(e),t=e("openSettingsBtn"),a=e("dropdownArrow"),s=e("dropdownMenu"),n=e("darkModeToggle"),o=e("dimSlider"),l=e("dimValue"),d=e("speedSlider"),i=e("speedValue"),r=e("resetBtn"),c=e("exportPDFBtn"),h=e("clearCacheBtn"),g=e("changeTitleBtn"),u=e("saveSessionBtn"),v=e("loadSessionBtn"),w=e("toggleQuickNote"),p=e("quickNoteTextarea");t.addEventListener("click",()=>{chrome.tabs.create({url:chrome.runtime.getURL("settings.html")})}),a.addEventListener("click",()=>{let e=s.classList.toggle("show");a.textContent=e?"▲":"▼"}),chrome.storage.local.get({showDarkMode:!0,showBrightness:!0,showPlayback:!0,showSaveImageAsPdf:!0,showClearCache:!0,showChangeTitle:!0,showSession:!0,darkMode:!1,dimVal:0,speedVal:1,speedMin:.25,speedMax:8},t=>{let a=(t,a)=>e(t).style.display=a?"block":"none";a("darkModeControl",t.showDarkMode),a("brightnessControl",t.showBrightness),a("speedControl",t.showPlayback),a("exportPDFBtn",t.showSaveImageAsPdf),a("clearCacheBtn",t.showClearCache),a("changeTitleBtn",t.showChangeTitle),a("saveSessionBtn",t.showSession),a("loadSessionBtn",t.showSession),n.checked=t.darkMode,o.value=l.textContent=t.dimVal,d.min=t.speedMin,d.max=t.speedMax,d.value=i.textContent=t.speedVal}),n.addEventListener("change",e=>{let t=e.target.checked;chrome.storage.local.set({darkMode:t}),send({action:"setDark",value:t})}),o.addEventListener("input",e=>{let t=e.target.value;l.textContent=t,chrome.storage.local.set({dimVal:t}),send({action:"setDim",value:t})}),d.addEventListener("input",e=>{let t=e.target.value;i.textContent=t,chrome.storage.local.set({speedVal:t}),send({action:"setSpeed",value:t})}),r.addEventListener("click",()=>{let t={darkMode:!1,dimVal:0,speedVal:1,speedMin:.25,speedMax:8,showDarkMode:!0,showBrightness:!0,showPlayback:!0,showSaveImageAsPdf:!0,showClearCache:!0,showChangeTitle:!0,showSession:!0};chrome.storage.local.set(t,()=>{n.checked=!1,o.value=l.textContent="0",d.value=i.textContent="1",d.min="0.25",d.max="8",["darkModeControl","brightnessControl","speedControl","exportPDFBtn","clearCacheBtn","changeTitleBtn","saveSessionBtn","loadSessionBtn"].forEach(t=>e(t).style.display="block"),send({action:"setDark",value:!1}),send({action:"setDim",value:0}),send({action:"setSpeed",value:1}),showToast("All settings restored")})}),c.addEventListener("click",()=>send({action:"exportPdf"})),h.addEventListener("click",()=>{chrome.tabs.query({active:!0,currentWindow:!0},([e])=>{e?.url&&chrome.browsingData.remove({origins:[new URL(e.url).origin]},{cache:!0,cookies:!0,localStorage:!0},()=>{let e=chrome.runtime.lastError;showToast(e?"Error clearing data":"Cache, cookies & storage cleared!")})})}),g.addEventListener("click",async()=>{let e=prompt("Enter new page title:");if(!e)return;let[t]=await chrome.tabs.query({active:!0,currentWindow:!0});t?.id&&chrome.scripting.executeScript({target:{tabId:t.id},func(e){document.title=e},args:[e]})}),u.addEventListener("click",()=>{chrome.storage.local.get(["darkMode","dimVal","speedVal"],e=>{chrome.storage.local.set({session:e},()=>showToast("Session saved!"))})}),v.addEventListener("click",()=>{chrome.storage.local.get("session",({session:e})=>{if(!e)return showToast("No saved session.");n.checked=e.darkMode,o.value=l.textContent=e.dimVal,d.value=i.textContent=e.speedVal,send({action:"setDark",value:e.darkMode}),send({action:"setDim",value:e.dimVal}),send({action:"setSpeed",value:e.speedVal}),showToast("Session loaded!")})}),w.addEventListener("click",()=>{let e="none"===p.style.display;p.style.display=e?"block":"none",e&&p.focus()}),chrome.tabs.query({active:!0,currentWindow:!0},([e])=>{let t=new URL(e.url).hostname.replace(/^www\./,"");chrome.storage.local.get({siteNotes:{}},({siteNotes:e})=>{p.value=e[t]||""})}),p.addEventListener("input",debounce(()=>{chrome.tabs.query({active:!0,currentWindow:!0},([e])=>{let t=new URL(e.url).hostname.replace(/^www\./,"");chrome.storage.local.get({siteNotes:{}},({siteNotes:e})=>{e[t]=p.value,chrome.storage.local.set({siteNotes:e})})})},300))});